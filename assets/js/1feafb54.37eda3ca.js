"use strict";(self.webpackChunkprojects_ieeebruins_com=self.webpackChunkprojects_ieeebruins_com||[]).push([[597],{6099:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>c,frontMatter:()=>s,metadata:()=>l,toc:()=>h});var t=i(5893),o=i(1151);const s={},r="Lab 4",l={id:"DAV/lab-4",title:"Lab 4",description:"Graphic Design Is My Passion",source:"@site/docs/DAV/lab-4.md",sourceDirName:"DAV",slug:"/DAV/lab-4",permalink:"/projects.ieeebruins.com/DAV/lab-4",draft:!1,unlisted:!1,editUrl:"https://github.com/UCLA-IEEE/projects.ieeebruins.com/tree/main/docs/DAV/lab-4.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"Lab 3",permalink:"/projects.ieeebruins.com/DAV/lab-3"},next:{title:"Lab 5",permalink:"/projects.ieeebruins.com/DAV/lab-5"}},a={},h=[{value:"Graphic Design Is My Passion",id:"graphic-design-is-my-passion",level:3},{value:"Introduction",id:"introduction",level:2},{value:"Resources and Reference Material",id:"resources-and-reference-material",level:2},{value:"Contact Us",id:"contact-us",level:2},{value:"1 VGArbage",id:"1-vgarbage",level:2},{value:"1.1 The VGA Constants",id:"11-the-vga-constants",level:3},{value:"1.2 The Pixel Counters",id:"12-the-pixel-counters",level:3},{value:"1.3 <code>hsync</code> and <code>vsync</code>",id:"13-hsync-and-vsync",level:3},{value:"1.4 The Pixel Color",id:"14-the-pixel-color",level:3},{value:"1.5 The Top Level",id:"15-the-top-level",level:3},{value:"2 I Can\u2019t Win",id:"2-i-cant-win",level:2},{value:"3 Graphic Design Will Be Your Passion Too",id:"3-graphic-design-will-be-your-passion-too",level:2},{value:"? Extra credit",id:"-extra-credit",level:2}];function d(e){const n={a:"a",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"lab-4",children:"Lab 4"}),"\n",(0,t.jsx)(n.h3,{id:"graphic-design-is-my-passion",children:"Graphic Design Is My Passion"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#1-vgarbage",children:"1: VGArbage"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#11-the-vga-constants",children:"1.1: The VGA Constants"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#12-the-pixel-counters",children:"1.2: The Pixel Counters"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#13-hsync-and-vsync",children:"1.3: hsync and vsynv"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#14-the-pixel-color",children:"1.4: The Pixel Color"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#15-the-top-level",children:"1.5: The Top Level"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#2-i-cant-win",children:"2: I Can't Win"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#3-graphic-design-will-be-your-passion-too",children:"3: Graphic Design Will Be Your Passion Too"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#extra-credit",children:"?: Extra Credit"})}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsx)(n.p,{children:"In Lecture 5, we covered the basics behind how a VGA works as well as some practices to keep in mind when you\u2019re working with your VGA. This lab will have you implement those practices in a way where you can use your code in your final capstone project. Today, you\u2019ll learn how writing to the VGA works, implement ping-pong RAM, and for some extra credit, basic blocking to implement a static image."}),"\n",(0,t.jsx)(n.h2,{id:"resources-and-reference-material",children:"Resources and Reference Material"}),"\n",(0,t.jsx)(n.p,{children:"Link to Lecture 5"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://docs.google.com/spreadsheets/d/1jTgphR61ozrNZlr9dLvId5t3o0FrikxSZWwAvhXF0Yo/edit#gid=0",children:"Pin Sheet"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://docs.google.com/document/d/1_8ruatZIb3sZb-3Kk3WOYC8Jzv4HvdwrTPZUGVupdVE/edit",children:"Verilog Docs and FAQs"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.a,{href:"https://github.com/amidthestars/DAV-Outreach-Module-Solutions",children:"Solution"})}),"\n",(0,t.jsx)(n.h2,{id:"contact-us",children:"Contact Us"}),"\n",(0,t.jsx)(n.p,{children:"You can contact the DAV leads on Discord."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Claire Huang"})," (Discord: ",(0,t.jsx)(n.em,{children:"zhiyujia"}),")",(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.strong,{children:"Premkumar Giridhar"})," (Discord: ",(0,t.jsx)(n.em,{children:"8bitrobot"}),")"]}),"\n",(0,t.jsx)(n.h2,{id:"1-vgarbage",children:"1 VGArbage"}),"\n",(0,t.jsxs)(n.p,{children:["To get started, ",(0,t.jsx)(n.a,{href:"https://drive.google.com/file/d/1hvoNzdLyxhBUwM9_1KTYdDiDnigi52x9/view?usp=sharing",children:"we\u2019ve provided a skeleton for you"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["You\u2019ll observe that the gist of the VGA is mostly counters and some combinational logic. You keep track of where you currently are on the VGA using some counters in the sequential block (and some related ",(0,t.jsx)(n.code,{children:"localparams"}),"), and what actually displays on that part of the VGA is determined in the combinational block."]}),"\n",(0,t.jsxs)(n.p,{children:["Your job now is to fill out the skeleton. We\u2019ve labeled the four parts as ",(0,t.jsx)(n.strong,{children:"TODO(1), TODO(2), TODO(3), TODO(4)"})," for your reference. The actual tasks should be fairly straightforward (and they\u2019re outlined in the skeleton!), but we\u2019ll describe them in this lab spec as well for completeness."]}),"\n",(0,t.jsx)(n.h3,{id:"11-the-vga-constants",children:"1.1 The VGA Constants"}),"\n",(0,t.jsxs)(n.p,{children:["Here, you\u2019re presented with 8 constants that you need to find the values for. You can easily find these numbers by Googling ",(0,t.jsx)(n.em,{children:"\u201cVGA timing spec\u201d"})," or similar. You can also find them in our lecture slides :-)"]}),"\n",(0,t.jsx)(n.p,{children:"Just keep in mind what each one is conceptually \u2013 you\u2019ll need them later!"}),"\n",(0,t.jsx)(n.h3,{id:"12-the-pixel-counters",children:"1.2 The Pixel Counters"}),"\n",(0,t.jsxs)(n.p,{children:["The pixel counters are the brain behind the VGA driver, and the sequential block triggered on the edge of our VGA clock is where we update them. If the reset button is pressed, you need to reset these counters to zero. Otherwise, you should increment the appropriate counter. The logic for counter increments is fairly straightforward \u2013 increment the horizontal counter ",(0,t.jsx)(n.code,{children:"hc"}),", and if it gets too high, increment ",(0,t.jsx)(n.code,{children:"vc"})," and set ",(0,t.jsx)(n.code,{children:"hc"})," back to zero. You\u2019ll need to use the parameters you defined earlier to figure out at what value of ",(0,t.jsx)(n.code,{children:"hc"})," you need to move to the next line."]}),"\n",(0,t.jsxs)(n.p,{children:["Also, keep in mind that ",(0,t.jsx)(n.code,{children:"hc"})," and ",(0,t.jsx)(n.code,{children:"vc"})," are zero-indexed when writing your conditions for incrementing them! If ",(0,t.jsx)(n.code,{children:"hc"})," equals 800 at any point, you did something wrong :-)"]}),"\n",(0,t.jsxs)(n.h3,{id:"13-hsync-and-vsync",children:["1.3 ",(0,t.jsx)(n.code,{children:"hsync"})," and ",(0,t.jsx)(n.code,{children:"vsync"})]}),"\n",(0,t.jsxs)(n.p,{children:["Here, you\u2019ll combinationally generate the ",(0,t.jsx)(n.code,{children:"hsync"})," and ",(0,t.jsx)(n.code,{children:"vsync"})," signals using the counter values. The parameters we defined earlier will come in handy here. Remember two things when figuring out the assignments:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"hsync"})," and ",(0,t.jsx)(n.code,{children:"vsync"})," should be HIGH for most of the time and driven LOW during the specific period within the blanking interval"]}),"\n",(0,t.jsxs)(n.li,{children:["the duration of ",(0,t.jsx)(n.code,{children:"hsync"})," and ",(0,t.jsx)(n.code,{children:"vsync"})," is susceptible to off-by-one errors \u2013 make sure to double-check your conditions!"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"14-the-pixel-color",children:"1.4 The Pixel Color"}),"\n",(0,t.jsxs)(n.p,{children:["Finally, you\u2019ll use a combinational block to assign the pixel color outputs ",(0,t.jsx)(n.code,{children:"red"}),", ",(0,t.jsx)(n.code,{children:"green"}),", and ",(0,t.jsx)(n.code,{children:"blue"}),". Remember to assign all the colors to 0 during blanking intervals and resets \u2013 otherwise, just assign the color values inputted via ",(0,t.jsx)(n.code,{children:"input_red"}),", ",(0,t.jsx)(n.code,{children:"input_green"}),", and ",(0,t.jsx)(n.code,{children:"input_blue"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"15-the-top-level",children:"1.5 The Top Level"}),"\n",(0,t.jsx)(n.p,{children:"This isn\u2019t labeled in the skeleton because you need to make it yourself, but in addition to filling out the VGA skeleton, you need a top level to drive it. This will include the following tasks:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Creating and instantiating a 25 MHz clock using a PLL"}),"\n",(0,t.jsx)(n.li,{children:"Instantiating the VGA module"}),"\n",(0,t.jsx)(n.li,{children:"Pin planning!"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["It\u2019ll be fairly obvious if your module is working as expected, so you ",(0,t.jsx)(n.em,{children:"probably"})," don\u2019t need to testbench for this one. But if you\u2019re having weird timing issues and can\u2019t figure out why, there\u2019s nothing a testbench can\u2019t help you figure out!"]}),"\n",(0,t.jsx)(n.h2,{id:"2-i-cant-win",children:"2 I Can\u2019t Win"}),"\n",(0,t.jsx)(n.p,{children:"In this section, you\u2019ll be implementing ping-pong RAM. If you recall from lecture, ping-pong RAM is a technique where our VGA reads from one memory buffer while our graphics driver writes to the other. This prevents the VGA from having its image change while it\u2019s being read \u2013 a very common source of screen-tearing."}),"\n",(0,t.jsx)(n.p,{children:"To implement this, it might be easier to first create the RAM as two arrays of registers, with one byte for each pixel on the screen (now you see why we used 8-bit color?). Once we have this working, we\u2019ll replace the arrays with RAM IPs."}),"\n",(0,t.jsx)(n.p,{children:"For this module, you should take in the following inputs:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A clock, to allow synchronous changes of the read and write RAM,"}),"\n",(0,t.jsxs)(n.li,{children:["The address to write at, or ",(0,t.jsx)(n.code,{children:"addrWrite"}),". This is dependent on the size of your array."]}),"\n",(0,t.jsxs)(n.li,{children:["Two values for ",(0,t.jsx)(n.code,{children:"addrRead_h"})," and ",(0,t.jsx)(n.code,{children:"addrRead_v"}),", which can be taken from your VGA module (remember the counters ",(0,t.jsx)(n.code,{children:"hc"})," and ",(0,t.jsx)(n.code,{children:"vc"}),"?),"]}),"\n",(0,t.jsxs)(n.li,{children:["And the data to write, or ",(0,t.jsx)(n.code,{children:"dataWrite"}),". The size of this is dependent on the size of your colors - if your red, green, and blue pixels are 4 bits each, this will be 12 bits."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Your module should output whatever was at the read address."}),"\n",(0,t.jsxs)(n.p,{children:["Now for the actual ping pong part. To switch the two RAMs, you can instantiate a 1 bit ",(0,t.jsx)(n.code,{children:"writeEnable"})," register. Then, when ",(0,t.jsx)(n.code,{children:"addrRead_h"})," and ",(0,t.jsx)(n.code,{children:"addrRead_v"})," both reach zero (a.k.a. the start of the frame), the ",(0,t.jsx)(n.code,{children:"writeEnable"})," register can be flipped. Make sure that the flipping is done sequentially, to keep everything in sync. In the combinational block, the selection of which RAM buffer to read/write can be determined based on ",(0,t.jsx)(n.code,{children:"writeEnable"}),", and this address can be used to read the data out to the VGA module. That means that this ping pong RAM module will need to be instantiated in the top level where you instantiated your VGA module."]}),"\n",(0,t.jsx)(n.p,{children:"Wow, that was a lot. What do you even do with this ping pong RAM?"}),"\n",(0,t.jsx)(n.h2,{id:"3-graphic-design-will-be-your-passion-too",children:"3 Graphic Design Will Be Your Passion Too"}),"\n",(0,t.jsx)(n.p,{children:"To encourage best practices, you\u2019ll implement a very basic graphics module too. Don\u2019t worry, you can just hardcode this part for now. This is just to show you a structure you can use for your final capstone project."}),"\n",(0,t.jsx)(n.p,{children:"This graphics module will also be implemented in the same top level as the other two modules. The gist of this module is that you supply it with an address and it tells you what color you need to put in your ping pong RAM, which will get sent to the VGA."}),"\n",(0,t.jsx)(n.p,{children:"In the graphics module, you\u2019ll want to take in the horizontal and vertical position (you can keep it as the HSYNC and VSYNC outputs from the VGA for now)."}),"\n",(0,t.jsx)(n.p,{children:"The module should output the following:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The color to be sent to the ping pong RAM,"}),"\n",(0,t.jsx)(n.li,{children:"And the address to read/write from in the ping pong RAM."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"(All of this is combinational, so there\u2019s no clock involved in this one!)"}),"\n",(0,t.jsx)(n.p,{children:"To calculate the address - if the horizontal and vertical position are in the blanking interval, set the address to 0. Otherwise, you can find the address by calculating vertical position * (number of pixels in a row) + horizontal position."}),"\n",(0,t.jsx)(n.p,{children:"To calculate the color, you can just hard code it to return a certain color if it\u2019s not in the blanking interval. If the horizontal and vertical positions are within the blanking interval, then the color should be all 0\u2019s."}),"\n",(0,t.jsx)(n.p,{children:"Now, it\u2019s a matter of wiring up the inputs and outputs from the modules you created, and now you have a VGA using ping pong RAM!"}),"\n",(0,t.jsx)(n.h2,{id:"-extra-credit",children:"? Extra credit"}),"\n",(0,t.jsx)(n.p,{children:"If you want to go above and beyond on this lab, here\u2019s a little exercise that will introduce you to blocking."}),"\n",(0,t.jsx)(n.p,{children:"Your job is to display this lad (shown below) on your VGA!"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"alt_text",src:i(3483).Z+"",width:"438",height:"468"})}),"\n",(0,t.jsx)(n.p,{children:"Remember that graphics module you created? You could in theory use the vertical position and horizontal position to specify a position within an array, and that array can be encoded with certain colors at each index. Then, you can just grab the color out of that array and pass it to the ping pong RAM, and everything will work like it did before."}),"\n",(0,t.jsx)(n.p,{children:"However! If we continued just like that, this mushroom would be very, very small. Each square would only be one pixel! What if we want to make this larger?"}),"\n",(0,t.jsx)(n.p,{children:"Well, we can implement a technique called blocking! In the top level, you can assign some wires to be a smaller version of the horizontal position and vertical position."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-verilog",children:"// horizontal_position ranges from 0 to 799\n// vertical_position ranges from 0 t0 525\n\n// x ranges from 0 to 39  (image width is 32px)\nassign x = horizontal_position / 20;\n// y ranges from 0 to 26 (image height is 24px)\nassign y = vertical_position / 20;\n"})}),"\n",(0,t.jsx)(n.p,{children:"For the 16x16px image given above, your division factors will have to be slightly different."}),"\n",(0,t.jsx)(n.p,{children:"Of course, this does mean that you will need to adjust your conditions in your graphics module to the new boundaries (where is the new blanking interval?). Once you\u2019ve done that, though, you can use x and y as the address to your array or RAM and pull the color out that way. Then, everything else is the same as it was before!"})]})}function c(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},3483:(e,n,i)=>{i.d(n,{Z:()=>t});const t=i.p+"assets/images/image7-13576d69119961b4b89675d2d1d81476.png"},1151:(e,n,i)=>{i.d(n,{Z:()=>l,a:()=>r});var t=i(7294);const o={},s=t.createContext(o);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);